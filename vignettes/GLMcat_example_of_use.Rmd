---
title: "GLMcat examples of use"
author: "Lorena Leon"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
     toc: true
     number_sections: true
     toc_depth: 4
     df_print: kable
     fontsize: 12pt
vignette: >
  %\VignetteEngine{knitr::knitr}
  %\VignetteIndexEntry{GLMcat examples of use}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



```{r }
library(GLMcat)
# library(gtools); library(vcdExtra); library(grid)
library(gridExtra)
library(gtools)
library(dplyr)
# #library(stringr)
library(ggplot2)
library(tidyr)
```

### Dataset

Data set description

```{r }
data("DisturbedDreams")
summary(DisturbedDreams)
str(DisturbedDreams)
```

# Reference models

* Reference, Logistic, Complete

```{r }
mod1 <- GLMcat(formula = Level ~ Age,
  categories_order = c("Not.severe", "Severe.1", "Severe.2", "Very.severe"),
  data = DisturbedDreams, distribution = "logistic")
```

Summary

```{r }
summary(mod1)
```

Number or observations

```{r }
nobs_glmcat(mod1)
```

Coefficients of the model

```{r }
coef(mod1)
```

Log-likelihood

```{r }
logLik(mod1)
```

AIC

```{r }
AIC(mod1)
```

BIC

```{r }
BIC(mod1)
```

predict_glmcation on new data

* Probability

```{r }
predict_glmcat(mod1, data = DisturbedDreams[1:5,], type = "prob")
```

* Linear predict_glmcator

```{r }
predict_glmcat(mod1, data = DisturbedDreams[1:5,], type = "linear.predict_glmcator")
```

* Cumulative probability

```{r }
predict_glmcat(mod1, data = DisturbedDreams[1:5,], type = "cum.prob")
```

* Reference, Logistic, Proportional

```{r }
mod2 <- GLMcat(formula = Level ~ Age, proportional_effects = "Age",
  categories_order = c("Not.severe", "Severe.1", "Severe.2", "Very.severe"),
  data = DisturbedDreams, distribution = "logistic")

summary(mod2)
logLik(mod2)
```

predict_glmcation on new data

* Probability

```{r }
predict_glmcat(mod2, data = DisturbedDreams[1:5,], type = "prob")
```

* Linear predict_glmcator

```{r }
# predict_glmcat(mod2, data = DisturbedDreams[1:5,], type = "linear.predict_glmcator")
```

* Cumulative probability

```{r }
predict_glmcat(mod2, data = DisturbedDreams[1:5,], type = "cum.prob")
```

* Reference, Cauchit, Complete

```{r }
mod3 <- GLMcat(formula = Level ~ Age,
  categories_order = c("Not.severe", "Severe.1", "Severe.2", "Very.severe"),
  data = DisturbedDreams, distribution = "cauchit")
summary(mod3)
logLik(mod3)
```

> Now we change the reference category (Severe.2)
and estimate again the three reference models:

* Reference, Logistic, Complete

```{r }
mod1_a <- GLMcat(formula = Level ~ Age,
  categories_order = c("Not.severe", "Severe.1", "Very.severe", "Severe.2"),
  data = DisturbedDreams, distribution = "logistic")
summary(mod1_a)
logLik(mod1_a)
```

* Reference, Logistic, Proportional

```{r }
mod2_a <- GLMcat(formula = Level ~ Age, proportional_effects = "Age",
  categories_order = c("Not.severe", "Severe.1", "Very.severe", "Severe.2"),
  data = DisturbedDreams, distribution = "logistic")
summary(mod2_a)
logLik(mod2_a)
```

* Reference, Cauchit, Complete

```{r }
mod3_a <- GLMcat(formula = Level ~ Age,
  categories_order = c("Not.severe", "Severe.1", "Very.severe", "Severe.2"),
  data = DisturbedDreams, distribution = "cauchit")
summary(mod3_a)
logLik(mod3_a)
```

> The log-likelihoods of the two models $(reference, Logistic, complete)$
are equal (since the canonical model is invariant under all permutations)
whereas the log-likelihoods $(reference, Logistic, proportional)$ and
$(reference, Cauchit, complete)$ are different.

# Adjacent models

The equivalence between $(adjacent, logistic, complete)$ and
$(reference, logistic, complete)$ models is evident at obtaining the Log-likelihood of the models:

* Adjacent, Logistic, Complete

```{r }
adj_logi <- GLMcat(formula = Level ~ Age, ratio = "adjacent", distribution = "logistic",
  categories_order = c("Not.severe", "Severe.1", "Severe.2", "Very.severe"),
  data = DisturbedDreams)
logLik(adj_logi)
summary(adj_logi)
```

>  Remark that despite the fact that the log-likelihoods are equal,
the parameters estimations are different $(\alpha \neq \alpha')$.
Defining the matrix $A^T$ as follows:

```{r }
matrix(c(1,-1,0,0,1,-1,0,0,1), nrow = 3)
```

we can check that $A^T * \alpha = \alpha'$.

#### Invariance under permutations
The adjacent models are stable under the reverse permutation

* Adjacent, Cauchit, Complete

```{r }
adj_cauchit <- GLMcat(formula = Level ~ Age, ratio = "adjacent", distribution = "cauchit",
  categories_order = c("Not.severe", "Severe.1", "Severe.2", "Very.severe"),
  data = DisturbedDreams)
logLik(adj_cauchit)
summary(adj_cauchit)
```


Reverse order:


```{r }
adj_cauchit_rev <- GLMcat(formula = Level ~ Age, ratio = "adjacent", distribution = "cauchit",
  categories_order = c("Very.severe", "Severe.2", "Severe.1", "Not.severe"),
  data = DisturbedDreams)
logLik(adj_cauchit_rev)
summary(adj_cauchit_rev)
```


* Adjacent, Gompertz, Proportional

```{r }
adj_gompertz <- GLMcat(formula = Level ~ Age, ratio = "adjacent", distribution = "gompertz",
  categories_order = c("Not.severe", "Severe.1", "Severe.2", "Very.severe"),
  proportional_effects = c("(Intercept)", "Age"),
  data = DisturbedDreams)
logLik(adj_gompertz)
summary(adj_gompertz)
```


Reverse order:


```{r }
adj_gompertz_rev <- GLMcat(formula = Level ~ Age, ratio = "adjacent", distribution = "gompertz",
  categories_order = c("Very.severe", "Severe.2", "Severe.1", "Not.severe"),
  proportional_effects = c("(Intercept)", "Age"),
  data = DisturbedDreams)
logLik(adj_gompertz_rev)
summary(adj_gompertz_rev)
```


* Adjacent, Gumbel, Proportional

```{r }
adj_gumbel <- GLMcat(formula = Level ~ Age, ratio = "adjacent", distribution = "gumbel",
  categories_order = c("Very.severe", "Severe.2", "Severe.1", "Not.severe"),
  proportional_effects = c("(Intercept)", "Age"),
  data = DisturbedDreams)
logLik(adj_gumbel)
summary(adj_gumbel)
```


 Remark that the log-likelihoods for the Cauchy
 distribution are the same, since it is symmetric;
 whereas the for the non symmetric Gomperts distribution
 the log-likelihoods are different.
 Moreover if the Gumbel distribution is used with the
 reverse order then its log-likelihood is equal to the
 model with Gompertz as the distribution, this is because
 the Gumbel distribution is the symmetric of the Gompertz distribution.
 Otherwise, the parameter estimations are reversed.

# Cumulative models

The equivalence between the $(cumulative, Gompertz, proportional)$
and $(sequential, Gompertz, proportional)$ models has been demonstrated by
Laara and Matthews (1985):

* Cumulative, Gompertz, Proportional

```{r }
cum_gompertz <- GLMcum(formula = Level ~ Age,
  categories_order = c("Not.severe", "Severe.1", "Severe.2", "Very.severe"),
  proportional_effects = "Age",
  data = DisturbedDreams,
  distribution = "gompertz")
cum_gompertz$`Log-likelihood`
(cum_gompertz$coefficients)
```

# Sequential models

* Sequential, Gompertz, Proportional

```{r }
seq_gompertz <- GLMcat(formula = Level ~ Age, ratio = "adjacent", distribution = "gompertz",
  categories_order = c("Very.severe", "Severe.2", "Severe.1", "Not.severe"),
  proportional_effects = c("(Intercept)", "Age"),
  data = DisturbedDreams)
logLik(seq_gompertz)
summary(seq_gompertz)

knitr::opts_chunk$set(fig.width=9, fig.height=5.5,
  message=FALSE, warning = FALSE, echo = FALSE,
  tidy = TRUE, tidy.opts = list(comment = FALSE))
```

# Properties

Reference

The $(reference, F , complete)$ and $(reference, F , proportional)$ models
are invariant under the $(J-1)!$ permutations
that fix the reference category.
But are they still invariant under other permutations?
The canonical $(reference, logistic, complete)$ model, being is
invariant under all permutations. Non-invariance of models may be
shown when F is analytically defined.
This is more complex for normal or Student distributions.
We obtain $J!$ $/$ $(J-1)!$ $=4$ plateaus as expected.

For the next two plots, degrees of freedom = 0.2 for Student distribution

```{r }
#
```

Reference Complete

```{r }
all_permutations <- permutations(
  v = c("Not.severe", "Severe.1", "Severe.2", "Very.severe"),
  repeats.allowed = F, n = 4, r = 4
)

plot <- list()

for (dist in c("logistic", "normal", "cauchit", "student")) {
  Log_lik_Vec <- NA
  for (element in 1:nrow(all_permutations)) {
    l <- GLMcat(formula = Level ~ Age, ratio = "reference",
      distribution = dist, freedom_degrees = 3,
      categories_order = all_permutations[element, ],
      # proportional_effects = c("(Intercept)", "Age"),
      data = DisturbedDreams)
    Log_lik_Vec[element] <- logLik(l)
  }
  Log_lik_Vec
  all_permutations_num <- permutations(v = c("1", "2", "3", "4"), repeats.allowed = F, n = 4, r = 4)
  names <- as.data.frame(all_permutations_num) %>% unite("z", remove = FALSE, sep = "")
  to_plot <- data.frame("LogLik" = Log_lik_Vec, "Permutation" = names[, 1])
  to_plot$LogLik <- round(to_plot$LogLik, digits = 4)
  to_plot$Permutation <- as.factor(to_plot$Permutation)
  to_plot$Distribution <- dist
  groups <- data.frame(gn = 1:length(unique(to_plot$LogLik)), LogLik = unique(to_plot$LogLik))
  to_plot <- left_join(to_plot, groups)
  to_plot <- to_plot[to_plot$LogLik >= -1000, ]
  title <- paste0("Reference, ", dist, ", complete")
  plot[[dist]] <- to_plot %>%
    arrange(-LogLik) %>%
    mutate(Permutation = factor(Permutation, levels = (Permutation))) %>%
    ggplot(aes(x = Permutation, y = LogLik)) +
    geom_point() +
    geom_line(aes(group = gn)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    ggtitle(title) +
    xlab("") +
    ylab("")
}

plot_adj <- grid.arrange(plot[["logistic"]], plot[["normal"]],
  plot[["cauchit"]], plot[["student"]],
  ncol = 2, nrow = 2)

# plot_adj
```

Reference Proportional

```{r }
plot <- list()
for (dist in c("logistic", "normal", "cauchit", "student")) {
  Log_lik_Vec <- NA
  for (element in 1:nrow(all_permutations)) {
    l <- GLMcat(formula = Level ~ Age, ratio = "reference",
      distribution = dist,
      categories_order = all_permutations[element, ],
      proportional_effects = c("(Intercept)", "Age"),
      data = DisturbedDreams)
    Log_lik_Vec[element] <- logLik(l)
  }
  Log_lik_Vec
  all_permutations_num <- permutations(v = c("1", "2", "3", "4"), repeats.allowed = F, n = 4, r = 4)
  names <- as.data.frame(all_permutations_num) %>% unite("z", remove = FALSE, sep = "")
  to_plot <- data.frame("LogLik" = Log_lik_Vec, "Permutation" = names[, 1])
  to_plot$LogLik <- round(to_plot$LogLik, digits = 4)
  to_plot$Permutation <- as.factor(to_plot$Permutation)
  to_plot$Distribution <- dist
  groups <- data.frame(gn = 1:length(unique(to_plot$LogLik)), LogLik = unique(to_plot$LogLik))
  to_plot <- left_join(to_plot, groups)
  to_plot <- to_plot[to_plot$LogLik >= -1000, ]
  title <- paste0("Reference, ", dist, ", proportional")
  plot[[dist]] <- to_plot %>%
    arrange(-LogLik) %>%
    mutate(Permutation = factor(Permutation, levels = (Permutation))) %>%
    ggplot(aes(x = Permutation, y = LogLik)) +
    geom_point() +
    geom_line(aes(group = gn)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    ggtitle(title) +
    xlab("") +
    ylab("")
}

plot_adj <- grid.arrange(plot[["logistic"]], plot[["normal"]],
  plot[["cauchit"]], plot[["student"]],
  ncol = 2, nrow = 2
)

# plot_adj
```

Adjacent and Cumulative

Let us note that the specific $(adjacent, logistic, complete)$ model is invariant under all permutations. For (adjacent, (cauchit, normal), Z), (cumulative, (logistic, normal), complete) and (cumulative, (logistic, cauchit, normal), proportional) models for all the $J! = 24$ permutations we obtain $J!/2! = 12$ plateaus as expected. Each plateau corresponds to a particular permutation and its associated reverse permutation.

Adjacent Complete


```{r }
all_permutations <- permutations(
  v = c("Not.severe", "Severe.1", "Severe.2", "Very.severe"),
  repeats.allowed = F, n = 4, r = 4
)
plot <- list()
for (dist in c("logistic", "normal", "cauchit", "gompertz")) {
  Log_lik_Vec <- NA
  for (element in 1:nrow(all_permutations)) {
    l <- GLMcat(formula = Level ~ Age, ratio = "adjacent",
      distribution = dist,
      categories_order = all_permutations[element, ],
      # proportional_effects = c("(Intercept)", "Age"),
      data = DisturbedDreams)
    Log_lik_Vec[element] <- logLik(l)
  }
  Log_lik_Vec
  all_permutations_num <- permutations(v = c("1", "2", "3", "4"), repeats.allowed = F, n = 4, r = 4)
  names <- as.data.frame(all_permutations_num) %>% unite("z", remove = FALSE, sep = "")
  to_plot <- data.frame("LogLik" = Log_lik_Vec, "Permutation" = names[, 1])
  to_plot$LogLik <- round(to_plot$LogLik, digits = 4)
  to_plot$Permutation <- as.factor(to_plot$Permutation)
  to_plot$Distribution <- dist
  groups <- data.frame(gn = 1:length(unique(to_plot$LogLik)), LogLik = unique(to_plot$LogLik))
  to_plot <- left_join(to_plot, groups)
  to_plot <- to_plot[to_plot$LogLik >= -1000, ]
  title <- paste0("Adjacent, ", dist, ", complete")
  plot[[dist]] <- to_plot %>%
    arrange(-LogLik) %>%
    mutate(Permutation = factor(Permutation, levels = (Permutation))) %>%
    ggplot(aes(x = Permutation, y = LogLik)) +
    geom_point() +
    geom_line(aes(group = gn)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    ggtitle(title) +
    xlab("") +
    ylab("")
}

plot_adj <- grid.arrange(plot[["logistic"]], plot[["normal"]],
  plot[["cauchit"]], plot[["gompertz"]],
  ncol = 2, nrow = 2
)
```


Adjacent Proportional

```{r }
all_permutations <- permutations(
  v = c("Not.severe", "Severe.1", "Severe.2", "Very.severe"),
  repeats.allowed = F, n = 4, r = 4
)
plot <- list()
for (dist in c("logistic", "normal", "cauchit", "gompertz")) {
  Log_lik_Vec <- NA
  for (element in 1:nrow(all_permutations)) {
    l <- GLMcat(formula = Level ~ Age, ratio = "adjacent",
      distribution = dist,
      categories_order = all_permutations[element, ],
      proportional_effects = c("(Intercept)", "Age"),
      data = DisturbedDreams)
    Log_lik_Vec[element] <- logLik(l)
  }
  Log_lik_Vec
  all_permutations_num <- permutations(v = c("1", "2", "3", "4"), repeats.allowed = F, n = 4, r = 4)
  names <- as.data.frame(all_permutations_num) %>% unite("z", remove = FALSE, sep = "")
  to_plot <- data.frame("LogLik" = Log_lik_Vec, "Permutation" = names[, 1])
  to_plot$LogLik <- round(to_plot$LogLik, digits = 4)
  to_plot$Permutation <- as.factor(to_plot$Permutation)
  to_plot$Distribution <- dist
  groups <- data.frame(gn = 1:length(unique(to_plot$LogLik)), LogLik = unique(to_plot$LogLik))
  to_plot <- left_join(to_plot, groups)
  to_plot <- to_plot[to_plot$LogLik >= -1000, ]
  title <- paste0("Adjacent, ", dist, ", proportional")
  plot[[dist]] <- to_plot %>%
    arrange(-LogLik) %>%
    mutate(Permutation = factor(Permutation, levels = (Permutation))) %>%
    ggplot(aes(x = Permutation, y = LogLik)) +
    geom_point() +
    geom_line(aes(group = gn)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    ggtitle(title) +
    xlab("") +
    ylab("")
}

plot_adj <- grid.arrange(plot[["logistic"]], plot[["normal"]],
  plot[["cauchit"]], plot[["gompertz"]],
  ncol = 2, nrow = 2
)
```


## Sequential

The $(sequential, F , complete)$ models are invariant under the transposition of the last two categories when F is symmetric. But are they still invariant under other permutations? Next figure investigates the case of (sequential, symmetric F , complete) models for all the J! = 24 permutations cdfs. We obtain J!/2! = 12 plateaus as expected for logistic (normal and cauchit failed at the estimation of certains permutation). Each plateau corresponds to a particular permutation and its associated transposition of the last two categories.

Sequential Complete

```{r }
plot3 <- list()
for (dist in c("logistic", "normal", "cauchit", "gompertz")) {
  Log_lik_Vec <- NA
  for (element in 1:nrow(all_permutations)) {
    skip_to_next <- FALSE
    tryCatch(
      {
        l <- GLMcat(formula = Level ~ Age, ratio = "sequential",
          distribution = dist,
          categories_order = all_permutations[element, ],
          # proportional_effects = c("(Intercept)", "Age"),
          data = DisturbedDreams)
        Log_lik_Vec[element] <- logLik(l)
      },
      error = function(e) {
        Log_lik_Vec[element] <- NA
        skip_to_next <<- TRUE
      }
    )
    if (skip_to_next) {
      next
    } else {
      Log_lik_Vec[element] <- l$`Log-likelihood`
    }
  }
  Log_lik_Vec[element] <- l$`Log-likelihood`
  all_permutations_num <- permutations(v = c("1", "2", "3", "4"), repeats.allowed = F, n = 4, r = 4)
  names <- as.data.frame(all_permutations_num) %>% unite("z", remove = FALSE, sep = "")
  to_plot <- data.frame("LogLik" = Log_lik_Vec, "Permutation" = names[, 1])
  to_plot$LogLik <- round(to_plot$LogLik, digits = 4)
  to_plot$Permutation <- as.factor(to_plot$Permutation)
  to_plot$Distribution <- dist
  groups <- data.frame(gn = 1:length(unique(to_plot$LogLik)), LogLik = unique(to_plot$LogLik))
  to_plot <- left_join(to_plot, groups)
  to_plot <- to_plot[to_plot$LogLik >= -1000, ]
  title <- paste0("Sequential, ", dist, ", complete")
  plot3[[dist]] <- to_plot %>%
    arrange(-LogLik) %>%
    mutate(Permutation = factor(Permutation, levels = (Permutation))) %>%
    ggplot(aes(x = Permutation, y = LogLik)) +
    geom_point() +
    geom_line(aes(group = gn)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    ggtitle(title) +
    xlab("") +
    ylab("")
}
plot_cum_com <- grid.arrange(plot3[["logistic"]], plot3[["normal"]],
  plot3[["cauchit"]], plot3[["gompertz"]],
  ncol = 2, nrow = 2
)
```

Sequential Propotional

```{r }
plot3 <- list()
for (dist in c("logistic", "normal", "cauchit", "gompertz")) {
  Log_lik_Vec <- NA
  for (element in 1:nrow(all_permutations)) {
    skip_to_next <- FALSE
    tryCatch(
      {
        l <- GLMcat(formula = Level ~ Age, ratio = "sequential",
          distribution = dist,
          categories_order = all_permutations[element, ],
          proportional_effects = c("(Intercept)", "Age"),
          data = DisturbedDreams)

      },
      error = function(e) {
        Log_lik_Vec[element] <- logLik(l)
        skip_to_next <<- TRUE
      }
    )
    if (skip_to_next) {
      next
    } else {
      Log_lik_Vec[element] <- l$`Log-likelihood`
    }
  }
  Log_lik_Vec[element] <- l$`Log-likelihood`
  all_permutations_num <- permutations(v = c("1", "2", "3", "4"), repeats.allowed = F, n = 4, r = 4)
  names <- as.data.frame(all_permutations_num) %>% unite("z", remove = FALSE, sep = "")
  to_plot <- data.frame("LogLik" = Log_lik_Vec, "Permutation" = names[, 1])
  to_plot$LogLik <- round(to_plot$LogLik, digits = 4)
  to_plot$Permutation <- as.factor(to_plot$Permutation)
  to_plot$Distribution <- dist
  groups <- data.frame(gn = 1:length(unique(to_plot$LogLik)), LogLik = unique(to_plot$LogLik))
  to_plot <- left_join(to_plot, groups)
  to_plot <- to_plot[to_plot$LogLik >= -1000, ]
  title <- paste0("Sequential, ", dist, ", proportional")
  plot3[[dist]] <- to_plot %>%
    arrange(-LogLik) %>%
    mutate(Permutation = factor(Permutation, levels = (Permutation))) %>%
    ggplot(aes(x = Permutation, y = LogLik)) +
    geom_point() +
    geom_line(aes(group = gn)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    ggtitle(title) +
    xlab("") +
    ylab("")
}
plot_cum_com <- grid.arrange(plot3[["logistic"]], plot3[["normal"]],
  plot3[["cauchit"]], plot3[["gompertz"]],
  ncol = 2, nrow = 2
)
```

Cumulative Complete


```{r }
for (dist in c("logistic", "normal", "cauchit", "gompertz")) {
  Log_lik_Vec <- NA
  for (element in 1:nrow(all_permutations)) {
    l <- GLMcum(
      formula = Level ~ Age,
      categories_order = all_permutations[element, ],
      data = DisturbedDreams,
      distribution = dist
    )
    Log_lik_Vec[element] <- l$`Log-likelihood`
  }
  Log_lik_Vec
  all_permutations_num <- permutations(v = c("1", "2", "3", "4"), repeats.allowed = F, n = 4, r = 4)
  names <- as.data.frame(all_permutations_num) %>% unite("z", remove = FALSE, sep = "")
  to_plot <- data.frame("LogLik" = Log_lik_Vec, "Permutation" = names[, 1])
  to_plot$LogLik <- round(to_plot$LogLik, digits = 4)
  to_plot$Permutation <- as.factor(to_plot$Permutation)
  to_plot$Distribution <- dist
  groups <- data.frame(gn = 1:length(unique(to_plot$LogLik)), LogLik = unique(to_plot$LogLik))
  to_plot <- left_join(to_plot, groups)
  to_plot <- to_plot[to_plot$LogLik >= -1000, ]
  title <- paste0("Cumulative, ", dist, ", complete")
  plot[[dist]] <- to_plot %>%
    arrange(-LogLik) %>%
    mutate(Permutation = factor(Permutation, levels = (Permutation))) %>%
    ggplot(aes(x = Permutation, y = LogLik)) +
    geom_point() +
    geom_line(aes(group = gn)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    ggtitle(title) +
    xlab("") +
    ylab("")
}
plot_cum <- grid.arrange(plot[["logistic"]], plot[["normal"]],
  plot[["cauchit"]], plot[["gompertz"]],
  ncol = 2, nrow = 2
)
```

Cumulative Proportional


```{r }
for (dist in c("logistic", "normal", "cauchit", "gompertz")) {
  Log_lik_Vec <- NA
  for (element in 1:nrow(all_permutations)) {
    l <- GLMcum(
      formula = Level ~ Age,
      categories_order = all_permutations[element, ],
      proportional_effects = c("Age"),
      data = DisturbedDreams,
      distribution = dist
    )
    Log_lik_Vec[element] <- l$`Log-likelihood`
  }
  Log_lik_Vec
  all_permutations_num <- permutations(v = c("1", "2", "3", "4"), repeats.allowed = F, n = 4, r = 4)
  names <- as.data.frame(all_permutations_num) %>% unite("z", remove = FALSE, sep = "")
  to_plot <- data.frame("LogLik" = Log_lik_Vec, "Permutation" = names[, 1])
  to_plot$LogLik <- round(to_plot$LogLik, digits = 4)
  to_plot$Permutation <- as.factor(to_plot$Permutation)
  to_plot$Distribution <- dist
  groups <- data.frame(gn = 1:length(unique(to_plot$LogLik)), LogLik = unique(to_plot$LogLik))
  to_plot <- left_join(to_plot, groups)
  to_plot <- to_plot[to_plot$LogLik >= -1000, ]
  title <- paste0("Cumulative, ", dist, ", Proportional")
  plot[[dist]] <- to_plot %>%
    arrange(-LogLik) %>%
    mutate(Permutation = factor(Permutation, levels = (Permutation))) %>%
    ggplot(aes(x = Permutation, y = LogLik)) +
    geom_point() +
    geom_line(aes(group = gn)) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    ggtitle(title) +
    xlab("") +
    ylab("")
}
plot_cum <- grid.arrange(plot[["logistic"]], plot[["normal"]],
  plot[["cauchit"]], plot[["gompertz"]],
  ncol = 2, nrow = 2
)

# source('~/Desktop/Test package/GLMcat_examples.R', echo=TRUE)
# source('C:/Users/leonvelasco/Google Drive/PhD most updated/Test package 3008/Test package/GLMcat_examples.R', echo=TRUE)
# rmarkdown::render("C:/Users/leonvelasco/Google Drive/PhD most updated/Test package 3008/Test package/GLMcat_examples.R", "pdf_document")
# rmarkdown::render("/home/leonvelasco/Downloads/GLMcat_examples.R", "pdf_document")
```


