---
title: "Discrete Choice Models"
author: "Lorena Leon, Jean Peyhardi et Catherine Trottier"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
     toc: true
     number_sections: true
     toc_depth: 4
     df_print: kable
     fontsize: 12pt
vignette: >
  %\VignetteEngine{knitr::knitr}
  %\VignetteIndexEntry{Discrete Choice Models}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r }
# devtools::load_all()
library(GLMcat)
```

### Dataset

The choice of travel mode of n = 210 passengers in Australia was investigated by Louviere et al. (2000), Greene (2003) and Tutz. The alternatives of travel mode are: air, train, bus, and car. As $category-specific$ variables they considered the travel time in vehicle (invt) and the general cost (gc), and, as the $global-variables$ they considered the household income (hinc), and the number of people traveling (psize).
As example data, GLMcat includes the database: TravelChoice; which we can load as follows:

```{r }
data("TravelChoice")
head(TravelChoice)
str(TravelChoice)
```

To execute the model proposed by Tutz (Example 8.4), we execute the Discrete_CM function with the specific parameters as follows:

```{r }
exp_8.4 <- Discrete_CM(
  formula = choice ~ hinc + gc + invt,
  case_id = "indv",
  alternatives = "mode",
  reference = "air",
  data = TravelChoice,
  alternative_specific = c("gc", "invt"),
  distribution = "logistic")
```

The reported estimates given in Table 8.4 correspond to the output:

```{r }
summary(exp_8.4)
```

According with Tutz, the income seems to be influential for the preference of train and bus over airplane. And, time in vehicle seems to have an impact for the choice of travel mode. Also, cost turns out to be non-influential if income is in the predict_glmcator.\\

### Louviere (2000), Table 6.2.

Constants only model

```{r }
(constant_model <- Discrete_CM(
  formula = choice ~ 1 ,
  case_id = "indv",
  alternatives = "mode",
  reference = c("air", "train", "bus", "car"),
  data = TravelChoice,
  distribution = "logistic"
))

(car_0 <- Discrete_CM(
  formula = choice ~ hinc[air] + psize[air] + gc + ttme,
  case_id = "indv",
  alternatives = "mode",
  reference = c("air", "train", "bus", "car"),
  alternative_specific = c("gc", "ttme"),
  data = TravelChoice,
  distribution = "logistic"
))
```

### The results reported in (REF Jean)
Student (3), air, LogLik = -185.65

```{r }
(air_30 <- Discrete_CM(
  formula = choice ~ hinc[air] + psize[air] + gc + ttme,
  case_id = "indv",
  alternatives = "mode",
  reference = "air",
  alternative_specific = c("gc", "ttme"),
  data = TravelChoice,
  distribution = "student",
  freedom_degrees = 3
))
```

Student (30), bus, LogLik = -183.79

```{r }
(bus_30 <- Discrete_CM(
  formula = choice ~ hinc[air] + psize[air] + gc + ttme,
  case_id = "indv",
  alternatives = "mode",
  reference = "bus",
  alternative_specific = c("gc", "ttme"),
  data = TravelChoice,
  distribution = "student",
  freedom_degrees = 30
))
```

Student (0.2), car, LogLik = -142

```{r }
(car_.2 <- Discrete_CM(
  formula = choice ~ hinc[air] + psize[air] + gc + ttme,
  case_id = "indv",
  alternatives = "mode",
  reference = "car",
  alternative_specific = c("gc", "ttme"),
  data = TravelChoice,
  distribution = "student",
  freedom_degrees = 0.2
))
```

Student (1.35), train, LogLik = -183.49

```{r }
(train_1.35 <- Discrete_CM(
  formula = choice ~ hinc[air] + psize[air] + gc + ttme,
  case_id = "indv",
  alternatives = "mode",
  reference = "train",
  alternative_specific = c("gc", "ttme"),
  data = TravelChoice,
  distribution = "student",
  freedom_degrees = 1.35
))
```

The results are clearly in favour of the reference alternative j0 =car since the gain in loglikelihood is 43.92 compared to MNL results, i.e., 24% of the log-likelihood. It is a very huge difference compared to the results given in the literature (Louviere et al., 2000; Greene, 2003), obtained with MNL and with NL. \\
Additional results presented in (REF JEAN)
## Logistic, car

```{r }
(table_4 <- Discrete_CM(
  formula = choice ~ ttme,
  case_id = "indv",
  alternatives = "mode",
  reference = "car",
  alternative_specific = "ttme",
  data = TravelChoice,
  distribution = "logistic"
))
# AIC(table_4)
```

#### Table 2 (without normalized space)

```{r }
(car_.2 <- Discrete_CM(
  formula = choice ~ hinc[air] + psize[air] + gc + ttme,
  case_id = "indv",
  alternatives = "mode",
  reference = "car",
  alternative_specific = c("gc", "ttme"),
  data = TravelChoice,
  distribution = "student",
  freedom_degrees = 0.45
))
# logLik(car_.2)
```

#### Table 4 (without normalized space)

```{r }
(car_8 <- Discrete_CM(
  formula = choice ~  ttme,
  case_id = "indv",
  alternatives = "mode",
  reference = "car",
  alternative_specific = c("ttme"),
  data = TravelChoice,
  distribution = "logistic"
))
# logLik(car_8)
```

#### Table 5 (without normalized space)

```{r }
(car_.45 <- Discrete_CM(
  formula = choice ~  ttme,
  case_id = "indv",
  alternatives = "mode",
  reference = "car",
  alternative_specific = c("ttme"),
  data = TravelChoice,
  distribution = "student",
  freedom_degrees = .45
))
# logLik(car_.45)
```

#### Table 6 (without normalized space)

```{r }
(car_.05 <- Discrete_CM(
  formula = choice ~  ttme,
  case_id = "indv",
  alternatives = "mode",
  reference = "car",
  alternative_specific = c("ttme"),
  data = TravelChoice,
  distribution = "student",
  freedom_degrees = .05
))
# logLik(car_.05)
```

Adjacent examples
Design matrix for cases

```{r }
dat_p <- TravelChoice[1:8,]
```

The order is alphabetical

```{r }
# (adj_1 <- Discrete_CM(
#   formula = choice ~ hinc + psize + gc + ttme,
#   case_id = "indv",
#   alternatives = "mode",
#   reference = c("train"),
#   alternative_specific = c("gc", "ttme"),
#   data = dat_p,
#   distribution = "logistic",
#   ratio = "adjacent"
# ))
# 
# (adj_2 <- Discrete_CM(
#   formula = choice ~ hinc[car] + psize[air] + gc + ttme,
#   case_id = "indv",
#   alternatives = "mode",
#   reference = c("train"),
#   alternative_specific = c("gc", "ttme"),
#   data = dat_p,
#   distribution = "logistic",
#   ratio = "adjacent"
# ))
# 
# (adj_3 <- Discrete_CM(
#   formula = choice ~ hinc[air] + psize[bus] + gc + ttme,
#   case_id = "indv",
#   alternatives = "mode",
#   reference = c("air"),
#   alternative_specific = c("gc", "ttme"),
#   data = dat_p,
#   distribution = "logistic",
#   ratio = "adjacent"
# ))
```

Extended example

```{r }
# (adj_4 <- Discrete_CM(
#   formula = choice ~ hinc[air] + psize[bus] + gc + ttme,
#   case_id = "indv",
#   alternatives = "mode",
#   reference = c("air"),
#   alternative_specific = c("gc", "ttme"),
#   data = TravelChoice,
#   distribution = "logistic",
#   ratio = "adjacent"
# ))
# 
# (adj_5 <- Discrete_CM(
#   formula = choice ~ hinc[air] + psize[bus] + gc + ttme,
#   case_id = "indv",
#   alternatives = "mode",
#   reference = c("air"),
#   alternative_specific = c("gc", "ttme"),
#   data = TravelChoice,
#   distribution = "cauchit",
#   ratio = "adjacent"
# ))
# 
# (ref_4 <- Discrete_CM(
#   formula = choice ~ hinc[air] + psize[bus] + gc + ttme,
#   case_id = "indv",
#   alternatives = "mode",
#   reference = c("air"),
#   alternative_specific = c("gc", "ttme"),
#   data = TravelChoice,
#   distribution = "logistic",
#   ratio = "reference"
# ))
# 
# (ref_5 <- Discrete_CM(
#   formula = choice ~ hinc[air] + psize[bus] + gc + ttme,
#   case_id = "indv",
#   alternatives = "mode",
#   reference = c("air"),
#   alternative_specific = c("gc", "ttme"),
#   data = TravelChoice,
#   distribution = "cauchit",
#   ratio = "reference"
# ))
```

